{
    "id": "change_status",
    "name": "ChangeStatus",
    "description": "Change the status of the user account",
    "preconditions": [
        { "allowedTransition": { "property": "status", "to": "$args.newStatus", "onFailure": { "raise": "InvalidStatusTransitionException", "message": "Cannot change status to $args.newStatus from $this.status" } } }
    ],
    "args": [
        { "name": "newStatus", "type": "UserStatus", "description": "New status for the user account", "required": true }
    ],
    "post": [
        { "property": "status", "value": "$args.newStatus" },
        { "property": "updatedAt", "value": "dateTime.now" }
    ],
    "noOpWhen": [
        { "equals": { "left": "$this.status", "right": "$args.newStatus"} }
    ],
    "emits": [
        { 
            "event": "UserStatusChanged", 
            "description": "Emits when a user's status changes",
            "maps": [
                { "property": "userId", "value": "$this.id" },
                { "property": "oldStatus", "value": "$prev.status" },
                { "property": "newStatus", "value": "$this.status" },
                { "property": "changedAt", "value": "$this.updatedAt" }
            ]
        },
        {
            "event": "UserAccountUpdated",
            "description": "Emits when a user account is updated after status change",
            "maps": [
              { "property": "userId", "value": "$this.id" },
              { "property": "updatedAt", "value": "$this.updatedAt" }
            ]
        }
    ]
}