{
    "id": "update_profile",
    "name": "UpdateProfile",
    "description": "Update the user's profile information",
    "preconditions": [ 
        { "not": { "condition": "IsSuspended", "onFailure": { "raise": "UserSuspendedException", "message": "Cannot update profile while suspended" } } } 
    ],
    "args": [
        { "name": "firstName", "type": "string", "description": "First name of the user", "required": true },
        { "name": "middleName", "type": "string", "description": "Middle name of the user", "required": false },
        { "name": "lastName", "type": "string", "description": "Last name of the user", "required": true },
        { "name": "email", "type": "string", "description": "Email address of the user", "required": true }
    ],
    "noOpWhen": [{
        "all": [
            { "equals": { "left": "$this.profile.name.firstName",  "right": "$args.firstName" } },
            { "equals": { "left": "$this.profile.name.middleName", "right": "$args.middleName" } },
            { "equals": { "left": "$this.profile.name.lastName",   "right": "$args.lastName" } },
            { "equals": { "left": "$this.email",                   "right": "$args.email" } }
        ]
    }],
    "post": [
        { "property": "profile.name.firstName", "value": "$args.firstName" },
        { "property": "profile.name.middleName", "value": "$args.middleName" },
        { "property": "profile.name.lastName", "value": "$args.lastName" },
        { "property": "email", "value": "$args.email" },
        { "property": "updatedAt", "value": "dateTime.now" }
    ],
    "emits": [
        { 
            "event": "user_profile_updated", 
            "description": "Emits when a user account is updated",
            "maps": [
                { "property": "userId", "value": "$this.id" },
                { "property": "updatedAt", "value": "$this.updatedAt" }
            ]
        }
    ]
}